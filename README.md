# Лабораторная работа 10

## Теория
BMP (от англ. Bitmap Picture) — формат хранения растровых изображений, разработанный компанией Microsoft. Подробное описание формата данных можно взять [тут](https://ru.wikipedia.org/wiki/BMP).

Структура заголовка BMP файла из MSDN.
```cpp
typedef struct tagBITMAPINFOHEADER {
  DWORD biSize;
  LONG  biWidth;
  LONG  biHeight;
  WORD  biPlanes;
  WORD  biBitCount;
  DWORD biCompression;
  DWORD biSizeImage;
  LONG  biXPelsPerMeter;
  LONG  biYPelsPerMeter;
  DWORD biClrUsed;
  DWORD biClrImportant;
} BITMAPINFOHEADER, *PBITMAPINFOHEADER;
```

Данные в формате BMP состоят из трёх основных блоков:
* Заголовок из структур `BITMAPINFOHEADER` и `BITMAPINFO` (последний содержит информационные поля, битовые макси для цветовых каналов, таблицу цветов);
* Цветовой профиль (опционально);
* Пиксельные данные.

**Стеганография (от греч. στεγανός «скрытый» + γράφω «пишу»; букв. «тайнопись»**) — способ передачи или хранения информации с учётом сохранения в тайне самого факта такой передачи (хранения).

**LSB (Least Significant Bit, наименьший значащий бит (НЗБ))** — суть этого метода стеганографии заключается в замене последних значащих битов в контейнере (изображения, аудио или видеозаписи) на биты скрываемого сообщения. Разница между пустым и заполненным контейнерами должна быть не ощутима для органов восприятия человека.

В данной лабораторной работе реализовать сокрытие информации методом **LSB** в изображениях формата **BMP**.

## Задание

Разработать консольное программное обеспечение для сокрытия информации методом **Least Significant Bits**.

ПО должно выполнять следующие функции:
* считать и вывести на экран заголовки **BMP** файла (структуры `BITMAPINFOHEADER`, `BITMAPINFO` в зависимости от версии);
* для изображений, имеющих цветовую разрядность >= 24 бита, выполнить сокрытие информации методом **Least Significant Bits (LSB)**;
* извлекать из **BMP** файла сокрытую информацию.

### Требования
Чтение и работа с **BMP** форматом, необходимо реализовать самостоятельно, не используя стронние библиотеки.

Использовать STL при реализации работы с **BMP** форматом **запрещено**.

### Пример работы программы

#### Сокрытие информации
```bash
lsb --crypt --input ~/original.bmp --output ~/with_message.bmp --message ~/message.txt
```

* `--crypt` - означает, что программа работает в режиме сокрытия информации;
* `--input` - полный путь до оригинального изображения;
* `--output` - полный путь до файла с сокрытой информацией;
* `--message` - полный путь до файла с информацией, которую необходимо скрыть в изображении.


#### Извлечение информации
```bash
lsb --decrypt --input ~/with_message.bmp --message ~/out_message.txt
```

* `--decrypt` - означает, что программа работает в режиме извлечения информации;
* `--input` - полный путь до изображения со скрытым сообщением;
* `--message` - полный путь до файла, в который необходимо записать сообщение из изображения.

#### Вывод на экран заголовка BMP изображения
```bash
lsb --info --input ~/image.bmp
```

* `--info` - означает, что программа работает в режиме получения заголовков изображения;
* `--input` - полный путь до изображения.


#### Вывод на экран инструкции по использованию
```bash
lsb --help
```

#### Обработка ошибок
ПО не должно ошибочно завершаться в случае некорректных входных данных. Следует учесть следующие случаи:

1. Если в командной стороке используется несколько режимов работы, то необходимо вывести сообщение в консоль, о том как необходимо использовать ПО.

**Пример**.
```bash
$ lsb --info --input ~/image.bmp --decrypt --input ~/with_message.bmp --message ~/out_message.txt
Usage:
  -- info ...
  --decrypt ...
  --crypt ...
```

2. Если в командной стороке не хватает аргументов, то необходимо вывести сообщение в консоль, о том как необходимо использовать ПО.

**Пример**.

Не хватает армументов `--message`.
```bash
$ lsb --decrypt --input ~/with_message.bmp
Usage:
  -- info ...
  --decrypt ...
  --crypt ...
```
**Пример**.

Нет параметра для `--input`.
```bash
$ lsb --decrypt --input --message ~/out_message.txt
Usage:
  -- info ...
  --decrypt ...
  --crypt ...
```

3. Если изображение не является **BMP** файлом, выведите сообщение об ошибке.

**Пример 2**. Нет параметра для `--input`.
```bash
$ lsb --decrypt --input ~/with_message.bmp --message ~/out_message.txt
Input file '~/with_message.bmp' is corrupted.
```

4. Если используются несколько одинаковых параметров, то необходимо вывести сообщение в консоль, о том как необходимо использовать ПО.

**Пример**.
```bash
$ lsb --decrypt --input ~/with_message.bmp --input ~/with_message2.bmp --message ~/out_message.txt
Usage:
  -- info ...
  --decrypt ...
  --crypt ...
```

5. Если сообщение, которое необходимо скрыть больше, чем емкость изображения, выведите ошибку.
**Пример**. 
```bash
$ lsb --crypt --input ~/original.bmp --output ~/with_message.bmp --message ~/message.txt
The input image is too small to hide the message.
```

### Рекомендации
1. В методе **LSB** можно использовать либо все 3 (или 4 с альфа-каналом) цветовых канала изображения (RGB или RGBA), либо какой-нибудь один (например зеленый).

2. Как правильно писать `help` для команд смотрите на примере команд `bash`. Например, введите в консоли `ls --help`.

3. Хотя в задании не требуется реализовать модульные тесты, но страйтесь проектировать программу и разделять код на фунции так, чтобы код можно было легко покрыть модульными тестами. Если для вашего кода трудно написать тесты, то он плохо структуирован и сконструирован. Это повлечет дополнительные требования и доработки от преподавателя.

## Литература
* [BMP](https://ru.wikipedia.org/wiki/BMP)
* [Sroting an Image (MSDN)](https://docs.microsoft.com/ru-ru/windows/desktop/gdi/storing-an-image)
* [LSB метод](https://habr.com/ru/post/422593/)
